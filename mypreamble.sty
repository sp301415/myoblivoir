\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mypreamble}[2022/04/13 My Frequently Used Preamble]

\makeatletter

\newif\if@thmchap
\@thmchapfalse
\DeclareOption{chapter}{\@thmchaptrue}

\newif\if@kotex
\@kotexfalse
\DeclareOption{kotex}{\@kotextrue}
\DeclareOption{hangul}{
    \@kotextrue
    \PassOptionsToPackage{hangul, nonfrench, finemath}{kotex}
}

\DeclareOption*{\PackageWarning{macros}{Unknown Option: \CurrentOption}}
\ProcessOptions\relax

% Engine Specific includes
\usepackage{iftex}
\ifluatex
    \usepackage{luacode}
    \usepackage{fontspec}
\fi
\ifxetex 
    \usepackage{fontspec}
\fi

% KoTeX
\if@kotex
    \usepackage{kotex}
    \ifpdftex
        \input glyphtounicode \pdfgentounicode=1
    \fi
\fi

% Math Packages
\usepackage{amsmath, amssymb, amsthm, mathtools, tikz, pgfplots}
\usetikzlibrary{cd, calc}
\pgfplotsset{compat=newest}
\allowdisplaybreaks{}

% Theorem Styles
\@ifundefined{theorem}{
\if@thmchap 
    \newtheorem{theorem}{Theorem}[chapter] 
\else
    \newtheorem{theorem}{Theorem} 
\fi
}{}
\@ifundefined{lemma}{\newtheorem{lemma}[theorem]{Lemma}}{}
\@ifundefined{proposition}{\newtheorem{proposition}[theorem]{Proposition}}{}
\@ifundefined{corollary}{\newtheorem*{corollary}{Corollary}}{}

\theoremstyle{definition}
\@ifundefined{definition}{\newtheorem{definition}[theorem]{Definition}}{}
\@ifundefined{problem}{\newtheorem{problem}{문제}}{}

\theoremstyle{remark}
\@ifundefined{remark}{\newtheorem*{remark}{Remark}}{}

% Graphics Packages
\usepackage{graphicx, float}

% Misc Packages
\usepackage[shortlabels]{enumitem}
\usepackage[cache=false]{minted}
\setminted{autogobble, breaklines, breakanywhere}
% https://github.com/gpoore/minted/issues/311
% TODO: get breakaftersymbolpre to work
\providecommand*{\codeinline}[1]{\Verb[breaklines, breakanywhere]{#1}}
\@ifpackageloaded{hyperref}{}{\usepackage[pdfencoding=auto]{hyperref}}

% Tabularray Settings
\usepackage{tabularray, caption}
\UseTblrLibrary{amsmath, booktabs}
\SetTblrTemplate{foot}{empty}
% Somehow empty doesn't work :(
\DefTblrTemplate{conthead-text}{default}{}
\DefTblrTemplate{conthead}{default}{}

% TODO: is making this a theme good idea?
\NewTblrTheme{nocaption}{\SetTblrTemplate{head}{empty}}
\NewTblrTheme{nocounter}{
    \SetTblrTemplate{caption-tag}{empty}
    \SetTblrTemplate{caption-sep}{empty}
}

% Common Macros
\providecommand*{\ZZ}{\ensuremath{\mathbb{Z}}}
\providecommand*{\QQ}{\ensuremath{\mathbb{Q}}}
\providecommand*{\RR}{\ensuremath{\mathbb{R}}}
\providecommand*{\CC}{\ensuremath{\mathbb{C}}}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}
\DeclarePairedDelimiter\braket{\langle}{\rangle}

% Swap * and non-* version of PairedDelimiter
\let\oldabs\abs
\def\abs{\@ifstar{\oldabs}{\oldabs*}}
\let\oldnorm\norm 
\def\norm{\@ifstar{\oldnorm}{\oldnorm*}}
\let\oldbraket\braket 
\def\norm{\@ifstar{\oldbraket}{\oldbraket*}}

\makeatother
